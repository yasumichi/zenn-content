---
title: "po4a åŒ–ã•ã‚Œã¦ã„ãªã„ POD ãƒšãƒ¼ã‚¸ã® po4a åŒ–"
emoji: "ğŸš€"
type: "tech"
topics:
  - "linux"
  - "gettext"
  - "pod"
  - "jm"
published: true
published_at: "2025-06-14 17:08"
---

## å‰å›ã®è¨˜äº‹

https://zenn.dev/yasumichi/articles/1f6873bc5cfefa

## ä»Šå›ã®ä½œæ¥­å¯¾è±¡

https://github.com/linux-jm/manual/tree/master/pod/sudo

ç¾åœ¨ã€ç¿»è¨³ã•ã‚Œã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€ä»¥ä¸‹ã®é€šã‚Šã€‚

- [sudo.pod](https://github.com/linux-jm/manual/blob/master/pod/sudo/draft/sudo.pod)
- [sudoers.pod](https://github.com/linux-jm/manual/blob/master/pod/sudo/draft/sudoers.pod)
- [visudo.pod](https://github.com/linux-jm/manual/blob/master/pod/sudo/draft/visudo.pod)

## POD ã¨ã¯

Perl é–¢é€£ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§è‰¯ãç”¨ã„ã‚‰ã‚Œã‚‹ã€ POD (Plain Old Documentation) å½¢å¼ã§æ›¸ã‹ã‚ŒãŸãƒšãƒ¼ã‚¸ã§ã™ã€‚

- [JM Project (Japanese)](https://linuxjm.sourceforge.io/)
- [perlpod - Plain Old Documentation ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ - perldoc.jp](https://perldoc.jp/docs/perl/5.40.0/perlpod.pod)

## po4a ç”¨ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä½œæˆ

```bash
$ cd manual/pod/sudo
$ mkdir -p po4a/{sudo,sudoers,visudo}
```

## æ—¢å­˜ã®ç¿»è¨³ã«ãŠã‘ã‚‹æ–‡å­—ã‚³ãƒ¼ãƒ‰ã®å¤‰æ›´

æ—¢å­˜ã®ç¿»è¨³ãŒã€`EUC-JP` ã§ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ãªã®ã§ `UTF-8` ã«å¤‰æ›´ã—ãŸã€‚

## åŸæ–‡ã¨æ—¢å­˜ã®ç¿»è¨³ã‹ã‚‰ PO ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹

### æœ€åˆã®è©¦ã¿

po4a-gettextize ã§ `sudo.pod` ã® ja.po ä½œæˆã‚’è©¦ã¿ã‚‹

```
$ po4a-gettextize --format pod --master original/sudo.pod --localized draft/sudo.pod --po po4a/sudo/ja.po
po4a-gettextize is only useful to convert previously existing translations to a PO based workflow. Once you successfully converted your project to po4a, you should use the po4a(1) program to maintain it and update your translations.
Attempt to call undefined import method with arguments ("process" ...) via package "Locale::Po4a::TransTractor" (Perhaps you forgot to load the package?) at /home/yasumichi/homebrew/Cellar/po4a/0.73_1/libexec/lib/perl5/Locale/Po4a/Pod.pm line 15.
po4a gettextize: Original has less strings than the translation (96<258). Please fix it by removing the extra entry from the translated file. You may need an addendum (cf po4a(7)) to reput the chunk in place after gettextization. A possible cause is that a text duplicated in the original is not translated the same way each time. Remove one of the translations, and you're fine.
po4a gettextization: Structure disparity between original and translated files:
msgid (at original/sudo.pod:42) is of type '=head1' while
msgstr (at draft/sudo.pod:42 draft/sudo.pod:51) is of type '=begin'.
Original text: NAME
Translated text: JM-copyright
(result so far dumped to gettextization.failed.po)
The gettextization failed (once again). Don't give up, gettextizing is a subtle art, but this is only needed once to convert a project to the gorgeous luxus offered by po4a to translators.
Please refer to the po4a(7) documentation, the section "HOWTO convert a pre-existing translation to po4a?" contains several hints to help you in your task
```

`Original has less strings than the translation (96<258).` ã¨ã‚ã‚‹é€šã‚Šã€ç¿»è¨³å´ã®èªæ•°ãŒåœ§å€’çš„ã«å¤šã„ã‚ˆã†ã ã€‚

```
msgid (at original/sudo.pod:42) is of type '=head1' while
msgstr (at draft/sudo.pod:42 draft/sudo.pod:51) is of type '=begin'.
```

æœ€åˆã®æ–¹ã§ã‚¨ãƒ©ãƒ¼ã«ãªã£ã¦ã„ã‚‹ã€‚ã©ã†ã‚‚ç¿»è¨³å´ã®ä»¥ä¸‹ã®éƒ¨åˆ†ãŒè¿½åŠ ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã ã€‚

```
=begin JM-copyright

Japanese Version Copyright (c) 2000-2004 Yuichi SATO
        all rights reserved.
Translated Sat Oct  7 14:39:18 JST 2000
        by Yuichi SATO <ysato444@yahoo.co.jp>
Updated & Modified Fri Dec  6 04:40:44 JST 2002 by Yuichi SATO
Updated & Modified Fri Apr 16 00:05:41 JST 2004 by Yuichi SATO

=end JM-copyright

=begin JM-word

WORD:        real uid        å®Ÿãƒ¦ãƒ¼ã‚¶ ID
WORD:        real gid        å®Ÿã‚°ãƒ«ãƒ¼ãƒ— ID
WORD:        effective uid   å®ŸåŠ¹ãƒ¦ãƒ¼ã‚¶ ID
WORD:        effective gid   å®ŸåŠ¹ã‚°ãƒ«ãƒ¼ãƒ— ID
WORD:        ownership       æ‰€æœ‰è€…
WORD:        permission      ã‚¢ã‚¯ã‚»ã‚¹æ¨©
WORD:        DISCLAIMER      æ”¾æ£„å®£è¨€

=end JM-word
```

### è¿½åŠ éƒ¨åˆ†ã‚’åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã«åˆ‡ã‚Šå‡ºã™

è£œéºæ ¼ç´ç”¨ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã™ã‚‹ã€‚

```
$ mkdir po4a/add_ja
```

`po4a/add_ja/sudo.ja.add` ã¨ã„ã†åå‰ã§è¿½åŠ éƒ¨åˆ†ã‚’åˆ‡ã‚Šå‡ºã—ã€ä»¥ä¸‹ã®ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è¿½åŠ ã—ãŸã€‚

```
PO4A-HEADER: mode=before; position=NAME
```

### ã‚³ãƒ¡ãƒ³ãƒˆã¨ã—ã¦æ®‹ã•ã‚Œã¦ã„ã‚‹åŸæ–‡ã®é™¤å»

ãªãŠã€`=begin JM-comment` ã‹ã‚‰ `=end JM-comment` ã§æŒŸã‚“ã ãƒ–ãƒ­ãƒƒã‚¯ã«ä»¥ä¸‹ã®ã‚ˆã†ã«åŸæ–‡ãŒã‚³ãƒ¡ãƒ³ãƒˆã¨ã—ã¦æ®‹ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã§ã‚ã‚‹ã€‚

```perl
=begin JM-comment

sudo - execute a command as another user

=end JM-comment
```

ã“ã‚Œã‚‰ã‚’å…¨ã¦é™¤å»ã™ã‚‹ã€‚

```
$ sed -z -i "s/\n=begin JM-comment[^=]*=end JM-comment\n//g" draft/sudo.pod
```

#### å‚è€ƒ

- [sedã§è¤‡æ•°è¡Œã«ã¾ãŸãŒã£ãŸæ–‡å­—åˆ—ã‚’ç½®æ›ã™ã‚‹æ–¹æ³• | ã‚²ãƒ³ã‚¾ã‚¦ç”¨ãƒã‚¹ãƒˆã‚¤ãƒƒãƒˆ](https://genzouw.com/entry/2019/09/09/085746/1722/)
- [ã€Bashã€‘sedã®æœ€çŸ­ä¸€è‡´ - åœ°æ–¹ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã®å­¦ç¿’æ—¥è¨˜](https://ryuichi1208.hateblo.jp/entry/2021/03/20/161134)
- [ã€è„±sedã€‘ã„ã„åŠ æ¸›ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§æ–‡å­—åˆ—ã‚’sedã§ç½®æ›ã™ã‚‹ãªã‚“ã¦ã‚„ã‚ã‚ˆã† #Linux - Qiita](https://qiita.com/ko1nksm/items/b4b342f77f6d3ee1a0a9) â€»ç›´æ¥é–¢ä¿‚ã¯ã‚ã‚Šã¾ã›ã‚“

### å†åº¦æŒ‘æˆ¦

```
$ po4a-gettextize --format pod --master original/sudo.pod --localized draft/sudo.pod --po po4a/sudo/ja.po
po4a-gettextize is only useful to convert previously existing translations to a PO based workflow. Once you successfully converted your project to po4a, you should use the po4a(1) program to maintain it and update your translations.
Attempt to call undefined import method with arguments ("process" ...) via package "Locale::Po4a::TransTractor" (Perhaps you forgot to load the package?) at /home/yasumichi/homebrew/Cellar/po4a/0.73_1/libexec/lib/perl5/Locale/Po4a/Pod.pm line 15.
```

ja.po ã®ä½œæˆã«ã¯æˆåŠŸã—ãŸã‚ˆã†ã ãŒã€è­¦å‘ŠãŒå‡ºã¦ã„ã‚‹ã€‚

`Attempt to call undefined import method` ã‚’ç¿»è¨³ã™ã‚‹ã¨ã€Œå®šç¾©ã•ã‚Œã¦ã„ãªã„ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºãã†ã¨ã—ã¾ã—ãŸã€ã¨ã„ã†ã“ã¨ã‚‰ã—ã„ã€‚

[perl5400delta - perl v5.40.0 ã§ã®å¤‰æ›´ç‚¹ - perldoc.jp](https://perldoc.jp/docs/perl/5.40.0/perl5400delta.pod) ã® [ä¸æ˜ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã® import ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã™ã¨è­¦å‘ŠãŒç™ºç”Ÿã—ã¾ã™](https://perldoc.jp/docs/perl/5.40.0/perl5400delta.pod#Calling32the32import32method32of32an32unknown32package32produces32a32warning)ã§èª¬æ˜ã•ã‚Œã¦ã„ã‚‹äº‹è±¡ã®ã‚ˆã†ã§ã‚ã‚‹ã€‚

å•é¡Œã¨ãªã£ã¦ã„ã‚‹ã®ã¯ã€`lib/perl5/Locale/Po4a/Pod.pm` ã®15è¡Œç›®ã«ã‚ã‚‹ä»¥ä¸‹ã®è¨˜è¿°ã§ã‚ã‚‹ã€‚

```perl
use Locale::Po4a::TransTractor qw(process new get_in_charset get_out_charset);
```

ãŸã ã€æœ¬å®¶ã®ãƒªãƒã‚¸ãƒˆãƒªã‚’ç¢ºèªã™ã‚‹ã¨æ—¢ã«ä¿®æ­£æ¸ˆã¿ã®å•é¡Œã®æ§˜ã§ã‚ã‚‹ã€‚

- [Use parent pragma in Pod module Â· mquinson/po4a@b0b3a67](https://github.com/mquinson/po4a/commit/b0b3a675cf375f03e8653aa397fdb576a5b5ba74)

### `sudoers.pod` ã® ja.po ä½œæˆ

è£œéºã‚’åˆ‡ã‚Šå‡ºã—ãŸã®ã¡ã€`po4a-gettextize` ã‚’å®Ÿè¡Œã—ãŸã€‚

```
$ po4a-gettextize --format pod --master original/sudoers.pod --localized draft/sudoers.pod --po po4a/sudoers/ja.po
po4a-gettextize is only useful to convert previously existing translations to a PO based workflow. Once you successfully converted your project to po4a, you should use the po4a(1) program to maintain it and update your translations.
Attempt to call undefined import method with arguments ("process" ...) via package "Locale::Po4a::TransTractor" (Perhaps you forgot to load the package?) at /home/yasumichi/homebrew/Cellar/po4a/0.73_1/libexec/lib/perl5/Locale/Po4a/Pod.pm line 15.
po4a gettextize: Original has less strings than the translation (300<321). Please fix it by removing the extra entry from the translated file. You may need an addendum (cf po4a(7)) to reput the chunk in place after gettextization. A possible cause is that a text duplicated in the original is not translated the same way each time. Remove one of the translations, and you're fine.
po4a gettextization: Structure disparity between original and translated files:
msgid (at original/sudoers.pod:196) is of type 'textblock' while
msgstr (at draft/sudoers.pod:214 draft/sudoers.pod:222 draft/sudoers.pod:266 draft/sudoers.pod:273 draft/sudoers.pod:821 draft/sudoers.pod:833 draft/sudoers.pod:849 draft/sudoers.pod:861 draft/sudoers.pod:876 draft/sudoers.pod:886 draft/sudoers.pod:1085 draft/sudoers.pod:1090 draft/sudoers.pod:1096 draft/sudoers.pod:1102) is of type '=begin'.
Original text: If a C<Cmnd> has associated command line arguments, then the arguments in the C<Cmnd> must match exactly those given by the user on the command line (or match the wildcards if there are any).  Note that the following characters must be escaped with a '\\' if they are used in command arguments: ',', ':', '=', '\\'.
Translated text: JM-comment
(result so far dumped to gettextization.failed.po)
The gettextization failed (once again). Don't give up, gettextizing is a subtle art, but this is only needed once to convert a project to the gorgeous luxus offered by po4a to translators.
Please refer to the po4a(7) documentation, the section "HOWTO convert a pre-existing translation to po4a?" contains several hints to help you in your task
```

èªæ•°ãŒåˆã‚ãªã„ã®ã§èª¿æŸ»ã—ã¦ã¿ã‚‹ã¨[ã‚³ãƒ¡ãƒ³ãƒˆã¨ã—ã¦æ®‹ã•ã‚Œã¦ã„ã‚‹åŸæ–‡ã®é™¤å»](#ã‚³ãƒ¡ãƒ³ãƒˆã¨ã—ã¦æ®‹ã•ã‚Œã¦ã„ã‚‹åŸæ–‡ã®é™¤å»)ã§ä½¿ã£ãŸæ­£è¦è¡¨ç¾ãŒä¸ååˆ†ã§ä»¥ä¸‹ã®ã‚ˆã†ã« `JM-comment` ãƒ–ãƒ­ãƒƒã‚¯å†…ã« `=` ãŒå­˜åœ¨ã™ã‚‹ãƒ–ãƒ­ãƒƒã‚¯ãŒé™¤å»ã§ãã¦ã„ãªã‹ã£ãŸã€‚

```perl
=begin JM-comment

If a C<Cmnd> has associated command line arguments, then the arguments
in the C<Cmnd> must match exactly those given by the user on the command line
(or match the wildcards if there are any).  Note that the following
characters must be escaped with a '\' if they are used in command
arguments: ',', ':', '=', '\'.

=end JM-comment
```

[æ­£è¦è¡¨ç¾ï¼šæœ€çŸ­ä¸€è‡´ã§ãƒãƒƒãƒã•ã›ã‚‹è¡¨ç¾ | WWWã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼ã‚º](https://www-creators.com/archives/1804)ã‚’å‚è€ƒã«æ­£è¦è¡¨ç¾ã‚’å¤‰ãˆã¦ã¿ãŸãŒã€ã†ã¾ãã„ã‹ãšâ€¦ã€‚å¤šåˆ†ã€sed ã§ã¯ä½¿ãˆãªã„æ–¹æ³•ãªã®ã ã‚ã†ã€‚

ã¨ã‚Šã‚ãˆãšã€æ‰‹ä½œæ¥­ã§é™¤å»ã—ãŸã®ã¡ã€`po4a-gettextize` ãŒæˆåŠŸã—ãŸã€‚

æ®‹ã‚Šã® `visudo.pod` ã¯ã€ã™ã‚“ãªã‚Š ja.po åŒ–ã«æˆåŠŸã—ãŸã€‚

## fuzzy ãƒ•ãƒ©ã‚°ã®é™¤å»

å„ç¿»è¨³ã‚¨ãƒ³ãƒˆãƒªã«ã¤ã„ã¦ã„ã‚‹ `fuzzy` ãƒ•ãƒ©ã‚°ã‚’é™¤å»ã™ã‚‹ã€‚

```po
#, fuzzy
```

## POT ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ

ã¨ã‚Šã‚ãˆãšã€ç©ºã® POT ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹ã€‚

```
$ touch po4a/sudo/sudo.pot
```

## po4aç”¨è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ

```
[po_directory] po4a/sudo

[type: pod] original/sudo.pod $lang:draft/sudo.pod \
       add_$lang:?po4a/add_$lang/add_ja/sudo.ja.add
```

## po4aã§ç¿»è¨³ã§ãã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹

```
$ po4a po4a/sudo/po4a.cfg
```

## Makefile ã®ä½œæˆ

manual/manual/cups/Makefile ã‚’æµç”¨ã€‚

```
THRESH = 100
EXTFLAGS =
PO4AFLAGS += -k $(THRESH) $(EXTFLAGS)

LANGS = ja

PACKAGE = sudo
PO4A_SUBDIRS = $(wildcard po4a/*)

WORK_DIR = .

all:    translate

translate: $(patsubst po4a/%, translate-%, $(PO4A_SUBDIRS))

# This target is to escape "add_*" directory in po4a.
translate-add_%:
        @:

translate-%:
        po4a $(PO4AFLAGS) -v --variable langs='$(LANGS)' \
          --previous --srcdir $(WORK_DIR) --destdir $(WORK_DIR) \
          po4a/$*/po4a.cfg

stats:  $(patsubst po4a/%, stat-%, $(PO4A_SUBDIRS))

stat-%:
        @for l in $(LANGS); do \
          echo -n "$*($$l): "; \
          msgfmt --statistics -o /dev/null po4a/$*/$$l.po; \
        done

page-stat:
        @LC_ALL=C po4a $(PO4AFLAGS) --force -v -k 0 --variable langs='$(LANGS)' \
          --previous --srcdir $(WORK_DIR) --destdir $(WORK_DIR) $(PO4ACFG) | \
          grep translated | \
          sed -e 's/(\([1-9][0-9]*\) strings)/(\1 of \1 strings)/' \
              -e 's/[()]//g' \
              -e 's/^draft\/man[1-9]\///' | \
          awk '{printf("%-15s: %7s (%3s/%3s)\n",$$1,$$3,$$5,$$7);}'
```
