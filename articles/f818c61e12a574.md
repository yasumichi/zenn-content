---
title: "mael ã‚’ VBA ã«ç§»æ¤ã™ã‚‹è©¦ã¿"
emoji: "ğŸ•Œ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: 
    - VBA
    - mael
    - python
published: true
---

## mael ã¨ã¯

[mael](https://github.com/KenjiOhtsuka/mael/tree/main) ã¨ã¯ã€Markdown ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ã€Excel ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã§ãã‚‹ Python ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§ã™ã€‚

### å‚è€ƒæ–‡çŒ®

- [ãƒ†ã‚¹ãƒˆä»•æ§˜æ›¸ã‚’Gitã§ç®¡ç†ã™ã‚‹: Markdownã‹ã‚‰Excelã‚’ä½œã‚‹ #ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª](https://qiita.com/KenjiOtsuka/items/6862fa9c26b053abfc4b)

ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’ Excel ã«ã—ãŸã„ãªã‚‰ã€ä»¥ä¸‹ã®æ–¹ãŒè‰¯ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

- [k-watanb/md_test_case_to_excel: Markdownã§æ›¸ã‹ã‚ŒãŸãƒ†ã‚¹ãƒˆä»•æ§˜æ›¸ã‚’Excelå½¢å¼ã«å¤‰æ›ã—ã¾ã™ã€‚](https://github.com/k-watanb/md_test_case_to_excel)
- [Markdown ã§æ›¸ã„ãŸãƒ†ã‚¹ãƒˆä»•æ§˜æ›¸ã‚’ Excel ã«å¤‰æ›ã—ãŸã„ - ç´™ä¸€é‡ã®ç©ã¿é‡ã­](https://www.yokoyan.net/entry/2021/10/27/080000)

## ãªãœ VBA ã«ç§»æ¤ã—ã‚ˆã†ã¨è€ƒãˆãŸã‹

ã„ã¾ã©ã VBA ã‹ã‚ˆã€ã¨ã„ã®ã¯ã”ã‚‚ã£ã¨ã‚‚ã§ã™ãŒâ€¦ã€‚

- è·å ´ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼ä¸Šã€Python ã‚„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ããªã„ãŸã‚ã€‚
- VBA ã§ã‚ã‚Œã°ã€é…å¸ƒå…ˆã«è¿½åŠ ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’é…å¸ƒã™ã‚‹å¿…è¦ãŒãªã„ã€‚

## ã©ã“ã¾ã§å†ç¾ã™ã‚‹ã‹

- yaml ã®å‡¦ç†ã¯ãƒãƒ¼ãƒ‰ãƒ«ãŒä¸ŠãŒã‚Šãã† -> config ã¯ Excel ãƒ–ãƒƒã‚¯ã«ã™ã‚‹?
  - ã¨ã‚Šã‚ãˆãš config å‘¨ã‚Šã¯å¾Œå›ã—
- åˆ—å¹…ã¯ Excel ã§ã®å˜ä½ã¨ä¸€ç·’ã«ã—ãŸã„
- åˆ—ã®å‹ã¯ã€`String` ã¨ `List` ã®äºŒç¨®é¡ãŒã‚ã‚‹ãŒã€ä¸¡æ–¹ã«å¯¾å¿œã™ã‚‹ã®ã‹?
  - ã¾ãšã¯ `String` ã®ã¿ã«å¯¾å¿œã™ã‚‹ã€‚
- `mael init` ã«å½“ãŸã‚‹æ“ä½œã‚’å®Ÿç¾ã™ã‚‹ã‹? -> ã¨ã‚Šã‚ãˆãšå®Ÿè£…ã—ãªã„
- ã¾ãšã¯ markdown ã‹ã‚‰ Excel ã‚·ãƒ¼ãƒˆã«è»¢è¨˜ã™ã‚‹éƒ¨åˆ†ã‚’å†ç¾ã—ãŸã„
  - mael ã§ã¯è¤‡æ•°ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¤‰æ›ã§ãã‚‹ãŒã€ã¨ã‚Šã‚ãˆãšå˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ«ã®å¤‰æ›ã‚’å®Ÿç¾ã™ã‚‹ã€‚

## æŠ€è¡“çš„èª²é¡Œ

### VBA ã§æ­£è¦è¡¨ç¾ã‚’æ‰±ã†ã«ã¯?

å‚ç…§è¨­å®šã§ `Microsoft VBScript Regular Expressions 5.5` ã‚’è¿½åŠ ã—ã€`RegExp` ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½¿ç”¨ã™ã‚‹ã€‚

#### å‚è€ƒæ–‡çŒ®

- [VBAã§æ­£è¦è¡¨ç¾ã‚’ä½¿ã† (1/3)|CodeZineï¼ˆã‚³ãƒ¼ãƒ‰ã‚¸ãƒ³ï¼‰](https://codezine.jp/article/detail/1655)

### VBA ã§ BOM ãªã— UTF-8 ãªãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€ã«ã¯?

å‚ç…§è¨­å®šã§ `Microsoft ActiveX Data Objects X.X Library` ã‚’è¿½åŠ ã—ã€`ADODB.Stream` ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½¿ç”¨ã™ã‚‹ã€‚

#### å‚è€ƒæ–‡çŒ®

- [ã€VBAã€‘UTF-8ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’1è¡Œãšã¤èª­ã¿å–ã‚‹ã€‚ #ExcelVBA - Qiita](https://qiita.com/msht0511/items/34e8edea81a0c3ebb349)
- [BOMæœ‰ç„¡UTF-8ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿æ›¸ã - ã¤ã‚‰ã¤ã‚‰ Excel VBA](https://tanaka0.hatenablog.com/entry/2019/05/06/091456)
- [ã€Excelã€‘ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿æ›¸ã_ADODB.Streamç·¨](https://atsumitm.iobb.net/its/its-050.php)

### VBA ã§å‹•çš„ãƒªã‚¹ãƒˆã‚„è¾æ›¸ã‚’æ‰±ã†ã«ã¯?

çµ„ã¿è¾¼ã¿ã® `Collection` ã‚„ `Dictionary` ã‚’ä½¿ã†ã‹ã€.NET ã® `System.Collections.ArrayList` ã‚’ä½¿ã†ã€‚

#### å‚è€ƒæ–‡çŒ®

- [Excel VBAã§ä½¿ãˆã‚‹å¯å¤‰é•·ãªã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã¾ã¨ã‚ #ExcelVBA - Qiita](https://qiita.com/minoru-nagasawa/items/fcd317fa58c2372f681d)
- [ArrayList ã‚¯ãƒ©ã‚¹ (System.Collections) | Microsoft Learn](https://learn.microsoft.com/ja-jp/dotnet/api/system.collections.arraylist)
- [[VBA]ArrayListã®ä½¿ã„æ–¹ã€ã‚½ãƒ¼ãƒˆã€å‹•çš„é…åˆ—](https://y-moride.com/vba/arraylist-how-to-use.html)

### VBA ã§ã‚¯ãƒ©ã‚¹ã‚’åˆ©ç”¨ã™ã‚‹ã«ã¯?

`ã‚¯ãƒ©ã‚¹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«` ã‚’åˆ©ç”¨ã™ã‚‹ã€‚

#### å‚è€ƒæ–‡çŒ®

- [ç°¡å˜ã§ä¾¿åˆ©ãªã‚¯ãƒ©ã‚¹ã‚’ä½œã£ã¦å­¦ã¶VBAã‚¯ãƒ©ã‚¹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å…¥é–€ - ExcelVBA - å’Œé¢¨ã‚¹ãƒ‘ã‚²ãƒ†ã‚£ã®ãƒ¬ã‚·ãƒ”](https://www.limecode.jp/entry/class/introduction)
- [VBAã§ã‚¯ãƒ©ã‚¹ã‚’ã¤ãã‚‹ #ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘ - Qiita](https://qiita.com/Kamo123/items/a4c7749fa30d8f68df28)
- [ExcelVBAã«ãŠã‘ã‚‹ã‚¯ãƒ©ã‚¹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®åŸºæœ¬ï½œè—é¼ /ainez](https://note.com/aane/n/n7a9e31be762f)
- [ã€ExcelVBAã€‘ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿(Initialize)ã«å¼•æ•°ã‚’æ¸¡ã›ãªã„å•é¡Œ - å’Œé¢¨ã‚¹ãƒ‘ã‚²ãƒ†ã‚£ã®ãƒ¬ã‚·ãƒ”](https://www.limecode.jp/entry/class/initialize-arguments)
- [VBAã®ã‚¯ãƒ©ã‚¹ã§Newã¨åŒæ™‚ã«å¼•æ•°ä»˜ãã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’èµ·å‹•ã™ã‚‹ä»£æ›¿æ¡ˆ - ãˆãã›ã‚‹ã¡ã‚…ã‚“ã¡ã‚…ã‚“](https://www.excel-chunchun.com/entry/20200805-vba-class-init)
- [VBA/VBScriptã®ã‚¯ãƒ©ã‚¹ã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã«å¼•æ•°ã‚’æ¸¡ã—ãŸã„ #VBA - Qiita](https://qiita.com/mitaken/items/42f16c2661caa7ff0002)
- [Excel VBAã§ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã«å¼•æ•°ã‚’æ¸¡ã™æ–¹æ³• | ç¸ç´¡ã](https://entsumugu.com/how-to-pass-arguments-to-constructor-in-excel-vba/)
- [ã€vbaã€‘å¼•æ•°ä»˜ãã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã®ä¸€æ¡ˆ - ã‚ãƒ¼ã·ã‚ãŠã˜ã•ã‚“](https://word-ozisan.hatenablog.com/entry/2022/09/16/144652)

### VBA ã§åˆ—æŒ™å‹ã‚’åˆ©ç”¨ã™ã‚‹ã«ã¯?

`Enum` ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆã‚’ä½¿ã†ã€‚

#### å‚è€ƒæ–‡çŒ®

- [Enum ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆ (VBA) | Microsoft Learn](https://learn.microsoft.com/ja-jp/office/vba/language/reference/user-interface-help/enum-statement)
- [ExcelVBAã§å®šæ•°Constã®ä»£ã‚ã‚Šã«Enumä½¿ã† & Enumã®è‡ªå‹•ä½œæˆ #VBAãƒã‚¯ãƒ­ - Qiita](https://qiita.com/nanashi0424/items/19b08c70e5d10946289b)

### Doxygen ã§ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆåŒ–ã‚’è€ƒæ…®ã™ã‚‹

VB.NET ç”¨ã®ãƒ•ã‚£ãƒ«ã‚¿ã‚’æµç”¨ã™ã‚‹ã€‚ã„ãã¤ã‹ç¨®é¡ãŒã‚ã‚‹ãŒã€awk ç‰ˆ [doxygen-vb-filter](https://github.com/sevoku/doxygen-vb-filter) ã®ä½¿ç”¨ã‚’è€ƒæ…®ã™ã‚‹ã€‚

ã‚³ãƒ¡ãƒ³ãƒˆã¯ã€`VB.NET Style` ã‚’æ¡ç”¨ã™ã‚‹ã€‚

#### å‚è€ƒæ–‡çŒ®

- [Documenting your sources Â· sevoku/doxygen-vb-filter Wiki](https://github.com/sevoku/doxygen-vb-filter/wiki/Documenting-your-sources)
- [Doxygenã«VB - vbfilter(awk): ã ã‚‰ã‚ã](http://r-satsuki.air-nifty.com/blog/2007/12/doxygenvb_vbfil_6201.html)
- [Excel VBAã‹ã‚‰Doxygenã‚’ç”¨ã„ã¦ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‡ºåŠ›ã™ã‚‹ #VBScript - Qiita](https://qiita.com/mima_ita/items/635d57cc277254900c6a)
- [Excel VBAã‹ã‚‰Doxygenã‚’ç”¨ã„ã¦ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‡ºåŠ›ã™ã‚‹ (2025 å¹´ç‰ˆ) #doxygen - Qiita](https://qiita.com/tkmr-akhs/items/35b35e52288ab5dfeec4)

## ç§»æ¤ä½œæ¥­

### å¤‰æ›ã®ãƒ¡ã‚¤ãƒ³å‡¦ç†éƒ¨åˆ†ã‚’ç¢ºèª

mael ã® [mael/main.py](https://github.com/KenjiOhtsuka/mael/blob/main/mael/main.py) ã‚’ç¢ºèªã—ã€[å¼•æ•°ã« `build` ãŒæŒ‡å®šã•ã‚ŒãŸå ´åˆã®å‡¦ç†](https://github.com/KenjiOhtsuka/mael/blob/main/mael/main.py#L62) ã‚’ç¢ºèªã™ã‚‹ã€‚

ã™ã‚‹ã¨ä»¥ä¸‹ã®è¨˜è¿°ã§ import ã•ã‚ŒãŸ [mael/excel_builder.py](https://github.com/KenjiOhtsuka/mael/blob/main/mael/excel_builder.py) ã® [convert](https://github.com/KenjiOhtsuka/mael/blob/main/mael/excel_builder.py#L135) ãŒå‘¼ã³å‡ºã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚‹ã€‚

```python
from .excel_builder import convert
```

### Excel ã¸ã®è»¢è¨˜ã¯ composer ã®ãŠä»•äº‹ã‚‰ã—ã„

`mael/excel_builder.py` ã® `convert` ã®[æœ€çµ‚è¡Œ](https://github.com/KenjiOhtsuka/mael/blob/main/mael/excel_builder.py#L283) ã§ã¯ã€[mael/composer.py](https://github.com/KenjiOhtsuka/mael/blob/main/mael/composer.py) ã§å®šç¾©ã•ã‚Œã¦ã„ã‚‹ [ExcelComposer](https://github.com/KenjiOhtsuka/mael/blob/main/mael/composer.py#L62) ã‚¯ãƒ©ã‚¹ã® [compose](https://github.com/KenjiOhtsuka/mael/blob/main/mael/composer.py#L124) ãƒ¡ã‚½ãƒƒãƒ‰ãŒå‘¼ã³å‡ºã•ã‚Œã¦ã„ã‚‹ã€‚

### ã‚»ãƒ«ã®å†…å®¹ã‚’ç®¡ç†ã™ã‚‹ã®ã¯ StepItem ã‚¯ãƒ©ã‚¹

`mael/excel_builder.py` ã® [StepItem ã‚¯ãƒ©ã‚¹](https://github.com/KenjiOhtsuka/mael/blob/main/mael/excel_builder.py#L107) ãŒã‚»ãƒ«ã®å†…å®¹ã‚’ç®¡ç†ã™ã‚‹ã‚¯ãƒ©ã‚¹ã§ã‚ã‚‹ã€‚

ã“ã®ã‚¯ãƒ©ã‚¹ã«ã¯ã€4ã¤ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¨2ã¤ã®ãƒ¡ã‚½ãƒƒãƒ‰ãŒã‚ã‚‹ã€‚

|ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£        |å½¹å‰²    |
|-------------|------|
|title        |åˆ—ã®ã‚¿ã‚¤ãƒˆãƒ«|
|type         |åˆ—ã®ã‚¿ã‚¤ãƒ— |
|content_lines|å†…å®¹ã®è¡Œãƒªã‚¹ãƒˆ  |
|content_items|å†…å®¹ã®é …ç›®ãƒªã‚¹ãƒˆ |

|ãƒ¡ã‚½ãƒƒãƒ‰            |å½¹å‰²                                                         |
|----------------|-----------------------------------------------------------|
|add_content_line|typeã«å¿œã˜ã¦ `content_lines` ã‹ `add_content_items` ã«å†…å®¹ã‚’åŠ ãˆã‚‹     |
|get_content     |typeã«å¿œã˜ã¦  `content_lines` ã‚’çµåˆã—ãŸæ–‡å­—åˆ—ã‹ `add_content_items` ã‚’è¿”ã™|

ã¦ã‹ã€Python ã¯ãƒ¡ã‚½ãƒƒãƒ‰ã®è¿”å´å‹ã‚’è¤‡æ•°æŒ‡å®šã§ãã‚‹ã®ã‹â€¦

è‹¥å¹²ã€å®Ÿè£…ãŒç•°ãªã‚‹ãŒã€VBA ã§æ›¸ãã¨ã“ã‚“ãªæ„Ÿã˜ã‹ãªâ€¦

```vba
''' <summary>Class StepItem</sammary>

Option Explicit

Public title As String
Private itemType As ValueType
Private contentLines As Collection
Private contentItems As Collection

''' <summary>Constructor</sammary>
Private Sub Class_Initialize()
    title = ""
    itemType = TYPE_STRING
    Set contentLines = New Collection
    Set contentItems = New Collection
End Sub

Public Sub Init(title_ As String, type_ As ValueType)
    title = title_
    itemType = type_
End Sub

''' <summary>Add line of Content</sammary>
''' <params id="content"></param>
Public Sub AddContentLine(content As String)
    If itemType = TYPE_STRING Then
        contentLines.Add (content)
    ElseIf itemType = TYPE_LIST Then
        contentItems.Add (content)
    End If
End Sub

''' <summary>Get lines of Content</sammary>
''' <returns>lines of Content</returns>
Public Function GetContent() As Collection
    If itemType = TYPE_STRING Then
        Set GetContent = contentLines
    ElseIf itemType = TYPE_LIST Then
        Set GetContent = contentItems
    End If
End Function
```

### ã¾ãšã¯ markdown ã‹ã‚‰1è¡Œãšã¤èª­ã¿å‡ºã—ã‚»ãƒ«ã«è»¢è¨˜ã—ã¦ã¿ã‚‹

```vba
'''<summary>Convert Markdown to Sheet</summary>
'''<params id="filePath"></params>
Sub Convert(filePath As String)
    Dim adoStream As New ADODB.Stream
    Dim rowNumber As Long
    Dim line As String
    
    With adoStream
        .Type = adTypeText
        .Charset = "UTF-8"
        .LineSeparator = adLF
        
        .Open
        .LoadFromFile filePath
        
        rowNumber = 1
        Do Until .EOS
            line = .ReadText(-2)
            Cells(rowNumber, 1).Value = line
            rowNumber = rowNumber + 1
        Loop
            
        .Close
    End With
End SubSub Convert(filePath As String)
    Dim adoStream As New ADODB.Stream
    Dim rowNumber As Long
    Dim line As String
    
    With adoStream
        .Open
        .Type = adTypeText
        .Charset = "UTF-8"
        .LineSeparator = adLF
        .LoadFromFile filePath
        
        rowNumber = 1
        Do Until .EOS
            line = .ReadText(-2)
            Cells(rowNumber, 1).Value = line
            rowNumber = rowNumber + 1
        Loop
            
        .Close
    End With
End Sub
```

[ãƒ†ã‚¹ãƒˆä»•æ§˜æ›¸ã‚’Gitã§ç®¡ç†ã™ã‚‹: Markdownã‹ã‚‰Excelã‚’ä½œã‚‹ #ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª](https://qiita.com/KenjiOtsuka/items/6862fa9c26b053abfc4b)ã®ä¾‹ã«ã‚ã‚‹ markdown ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¾ã›ã‚‹ã¨ä¸‹å›³ã®ã‚ˆã†ã«ãªã‚‹ã€‚

![](https://storage.googleapis.com/zenn-user-upload/2e95a4d6ade6-20250628.png)

### æ–‡æ›¸ã®ã‚¿ã‚¤ãƒˆãƒ«ã‚’å–å¾—ã—ã¦ã‚·ãƒ¼ãƒˆã‚’è¿½åŠ ã™ã‚‹éƒ¨åˆ†ã‚’ä½œæˆã—ã¦ã¿ã‚‹

`mael/excel_builder.py` ã® [167è¡Œç›®](https://github.com/KenjiOhtsuka/mael/blob/main/mael/excel_builder.py#L167)ã‹ã‚‰å§‹ã¾ã‚‹å‡¦ç†ã‚’ç§»æ¤ã™ã‚‹ã€‚

ã¾ãšã€ã‚·ãƒ¼ãƒˆåã¯ä½¿ãˆãªã„æ–‡å­—ãŒã‚ã®ã§ãã‚Œã‚’æ­£è¦åŒ–ã™ã‚‹é–¢æ•°ã‚’ç”¨æ„ã™ã‚‹ã€‚ä½¿ãˆãªã„æ–‡å­—ã‚’æ¤œç´¢ã—ãŸã‚‰ã€Google AI ãŒã‚³ãƒ¼ãƒ‰ä¾‹ã‚’å‡ºã—ã¦ãã‚ŒãŸã®ã§æµç”¨ã™ã‚‹ã€‚

```vba
''' <summary>Normalize Sheet Name</sammary>
Function EscapeSheetName(ByRef sheetName As String) As String
    Dim reservedChars As String
    Dim i As Long
    Dim escapedName As String

    reservedChars = "\/?*" & Chr(34) & "<>" & "|"
    escapedName = sheetName

    For i = 1 To Len(reservedChars)
        escapedName = Replace(escapedName, Mid(reservedChars, i, 1), "_")
    Next i

    EscapeSheetName = escapedName
End Function
```

ã‚ˆãè¦‹ãŸã‚‰ã€ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã¾ã§å«ã¾ã‚Œã¦ã„ãŸã€‚

```vba
Sub TestEscapeSheetName()
    Dim sheetName As String
    sheetName = "ãƒ†ã‚¹ãƒˆã‚·ãƒ¼ãƒˆ\/?*" & Chr(34) & "<>|"
    Debug.Print EscapeSheetName(sheetName) ' Output: ãƒ†ã‚¹ãƒˆã‚·ãƒ¼ãƒˆ_____"____
End Sub
```

å‰é …ã®ã‚³ãƒ¼ãƒ‰ã§ `Do Until .EOS` ãƒ–ãƒ­ãƒƒã‚¯ã®å‰ã«ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ãŸã€‚

```vba
        ' set name
        Do Until .EOS
            line = .ReadText(-2)
            
            With New RegExp
                .Pattern = "^#[^#]\s*(\S.*)\s*$"
                Set mc = .Execute(line)
                If mc.Count > 0 Then
                    ActiveWorkbook.Sheets.Add
                    ActiveSheet.Name = EscapeSheetName(mc(0).SubMatches(0))
                    Exit Do
                End If
            End With
        Loop
        
        If .EOS Then
            MsgBox "Can not find title."
            Exit Sub
        End If
```

### Summary ã®å‡¦ç†

`mael/excel_builder.py` ã® [178è¡Œç›®](https://github.com/KenjiOhtsuka/mael/blob/main/mael/excel_builder.py#L178)ï½[202è¡Œç›®](https://github.com/KenjiOhtsuka/mael/blob/main/mael/excel_builder.py#L202)ã¾ã§ã®å‡¦ç†ã‚’ç§»æ¤ã™ã‚‹ã€‚

```vba
        ' set summary
        Dim hasSammary As Boolean
        hasSammary = False
        Do Until .EOS
            line = .ReadText(-2)
            
            With New RegExp
                .Pattern = "^##\s*Summary\s*$"
                If .Test(line) Then
                    hasSammary = True
                    Exit Do
                End If
            End With
        Loop
               
        If hasSammary Then
            With Cells(rowNumber, 1)
                .Value = "Summary"
                .Font.Bold = True
                rowNumber = rowNumber + 2
            End With
        End If
        
        ' read summary lines
        Do Until .EOS
            line = .ReadText(-2)
            
            With New RegExp
                .Pattern = "^##\s*(List|Steps|Rows)\s*$"
                If .Test(line) Then
                    rowNumber = rowNumber + 1
                    Exit Do
                End If
            End With
            
            Cells(rowNumber, 1).Value = RTrim(line)
            rowNumber = rowNumber + 1
        Loop
```

### è¡¨ã®å†…å®¹ã«ã‚ãŸã‚‹éƒ¨åˆ†ã®å‡¦ç†

ç¶šã„ã¦ã€è¡¨ã®å†…å®¹ã«ã‚ãŸã‚‹éƒ¨åˆ†ã‚’ `steps` ã¨ã„ã† `Collection` å‹ã®å¤‰æ•°ã«ç©ã‚“ã§ã„ãã€‚

```vba
        ' read steps
        Dim steps As New Collection
        Dim stepDict As New Scripting.Dictionary
        Dim columns As New Scripting.Dictionary
        Dim item As StepItem
        Dim title As String
        Set item = Nothing
        Do While True
            line = .ReadText(-2)
            
            If .EOS Then
                If Not item Is Nothing Then
                    stepDict.Add item.title, item.GetContent()
                End If
                If stepDict.Count > 0 Then
                    steps.Add stepDict
                End If
                Exit Do
            End If
            
            With New RegExp
                .Pattern = "^\s*---\s*$"
                If .Test(line) Then
                    If Not item Is Nothing Then
                        stepDict.Add item.title, item.GetContent()
                        Set item = Nothing
                    End If
                    If stepDict.Count > 0 Then
                        steps.Add stepDict
                        Set stepDict = New Scripting.Dictionary
                    End If
                    GoTo CONTINUE
                End If
                
                .Pattern = "^#{3,}\s*(\S.*\S|\S)\s*$"
                Set mc = .Execute(line)
                If mc.Count > 0 Then
                    If Not item Is Nothing Then
                        stepDict.Add item.title, item.GetContent()
                    End If
                    
                    title = mc(0).SubMatches(0)
                    If Not columns.Exists(title) Then
                        columns.Add title, ""
                    End If
                    
                    Set item = New StepItem
                    item.Init title, TYPE_STRING
                    GoTo CONTINUE
                End If
                
                If Not item Is Nothing Then
                    item.AddContentLine (RTrim(line))
                End If
            End With
            'Cells(rowNumber, 1).Value = line
            'rowNumber = rowNumber + 1]
CONTINUE:
        Loop
```

ãã—ã¦ã€å®Ÿéš›ã®è¡¨ã«è»¢è¨˜ã™ã‚‹å‡¦ç†ã‚’å®Ÿè£…ã€‚

```vba
        Dim key As Variant
        Dim colNumber As Long
        colNumber = 1
        For Each key In columns.Keys
            titleRow = rowNumber
            With Cells(rowNumber, colNumber)
                .Value = key
                .Font.Bold = True
                .HorizontalAlignment = xlCenter
            End With
            colNumber = colNumber + 1
        Next
        
        rowNumber = rowNumber + 1
        
        Dim obj As Object
        Dim content As Collection
        For Each stepDict In steps
            colNumber = 1
            For Each key In columns.Keys
                If stepDict.Exists(key) Then
                    Set content = stepDict.item(key)
                    Cells(rowNumber, colNumber).Value = JoinCollection(content)
                End If
                colNumber = colNumber + 1
            Next
            rowNumber = rowNumber + 1
        Next
```

æœ€å¾Œã«ç½«ç·šã‚’å¼•ãã€‚

```vba
        ' format borders
        With Range(Cells(titleRow, 1), Cells(rowNumber - 1, columns.Count))
            For index = xlEdgeLeft To xlInsideHorizontal
                With .Borders(index)
                    .LineStyle = xlContinuous
                    .ColorIndex = 0
                    .TintAndShade = 0
                    .Weight = xlThin
                End With
            Next
        End With
```

### Convert å‘¼ã³å‡ºã—éƒ¨åˆ†ã®å®Ÿè£…

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å¤‰æ›ã—ãŸã„ markdow ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã•ã›ã€`Convert` ãƒ—ãƒ­ã‚·ãƒ¼ã‚¸ãƒ£ã‚’å‘¼ã¶ã€‚

```vba
'''<summary>Control Build Process</summary>
Sub Build()
    Dim filePath As Variant
    
    filePath = Application.GetOpenFilename("markdown,*.md")
    
    If filePath = False Then
        Exit Sub
    End If
    
    Convert CStr(filePath)
End Sub
```

### ãƒªãƒœãƒ³ã‚’ã¤ã‘ã‚‹

ãƒªãƒœãƒ³ã‚’ç·¨é›†ã—ã‚ˆã†ã¨æ€ã„ã€[Office Custom UI Editor](https://github.com/OfficeDev/office-custom-ui-editor) ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã‚ˆã†ã¨æ€ã£ãŸã‚‰ã€ã„ã¤ã®é–“ã«ã‹ã€`Public archive` ã«ã•ã‚Œã¦ãŸâ€¦ ğŸ˜…

[Office RibbonX Editor](https://github.com/fernandreu/office-ribbonx-editor) ãŒã€`Office Custom UI Editor` ã‹ã‚‰ fork ã—ãŸã‚‰ã—ã„ã®ã§ãã¡ã‚‰ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã«ã™ã‚‹ã€‚

Microsoft ã® Copilot ã«ã‚¢ã‚¤ã‚³ãƒ³ã‚’ä½œæˆã—ã¦ã‚‚ã‚‰ã£ãŸã€‚

![](https://raw.githubusercontent.com/yasumichi/maelForVBA/refs/heads/main/customUI/images/Build.png)

ãƒªãƒœãƒ³ã‹ã‚‰å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã« `Build` ãƒ—ãƒ­ã‚·ãƒ¼ã‚¸ãƒ£ã«å¼•æ•°ã‚’è¿½åŠ ã™ã‚‹ã€‚

```vba
Sub Build(control As IRibbonControl)
```

ãã—ã¦ã€`customUI.xml` ã‚’ä½œæˆã™ã‚‹ã€‚

```xml
<customUI xmlns="http://schemas.microsoft.com/office/2006/01/customui">
	<ribbon>
		<tabs>
			<tab id="maelTab" label="mael" insertAfterMso="TabView">
				<group id="maelGroup" label="maelForVBA">
					<button id="BuildButton1" label="Build" size="large" onAction="Build" image="Build" />
				</group>
			</tab>
		</tabs>
	</ribbon>
</customUI>
```

ã§ããŸãƒªãƒœãƒ³ã¯ã€ã“ã‚“ãªæ„Ÿã˜ã€‚

![](https://storage.googleapis.com/zenn-user-upload/edda1857b226-20250628.png)

### ç¾çŠ¶ã®å¤‰æ›çµæœ

[ãƒ†ã‚¹ãƒˆä»•æ§˜æ›¸ã‚’Gitã§ç®¡ç†ã™ã‚‹: Markdownã‹ã‚‰Excelã‚’ä½œã‚‹ #ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª](https://qiita.com/KenjiOtsuka/items/6862fa9c26b053abfc4b)ã®ä¾‹ã«ã‚ã‚‹ markdown ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¾ã›ã‚‹ã¨ä¸‹å›³ã®ã‚ˆã†ã«ãªã‚‹ã€‚

![](https://storage.googleapis.com/zenn-user-upload/7c81647c881a-20250628.png)

è¿‘ã„ã†ã¡ã« column_config ã«å¯¾å¿œã—ã¦ã€æœ¬æ¥ã®å‡ºåŠ›ã«è¿‘ã¥ã‘ãŸã„ã€‚

## GitHub ã®ãƒªãƒã‚¸ãƒˆãƒª

[yasumichi/maelForVBA: mael for VBA is a partial port of mael.](https://github.com/yasumichi/maelForVBA)

ã“ã“ã¾ã§ã®æˆæœã‚’ãƒãƒ¼ã‚¸ãƒ§ãƒ³ [0.1](https://github.com/yasumichi/maelForVBA/releases/tag/0.1) ã¨ã—ã¦ã€ãƒ—ãƒ¬ãƒªãƒªãƒ¼ã‚¹ã—ãŸã€‚

### è¿½è¨˜

äºˆæœŸã›ã¬ markdown ãƒ•ã‚¡ã‚¤ãƒ«ãŒä¸ãˆã‚‰ã‚ŒãŸå ´åˆã«ç•°å¸¸çµ‚äº†ã™ã‚‹ãƒã‚°ã‚’ä¿®æ­£ã—ã€[0.1.1](https://github.com/yasumichi/maelForVBA/releases/tag/0.1.1) ã‚’ãƒ—ãƒ¬ãƒªãƒªãƒ¼ã‚¹ã—ãŸã€‚
