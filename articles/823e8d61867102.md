---
title: "GitBucket  Markdown Enhanced Plugin ã§ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ™‚ã« KaTeX ãŒæç”»ã•ã‚Œãªã„å•é¡Œã®å¯¾å‡¦"
emoji: "ğŸ•"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["GitBucket", "JavaScript"]
published: true
---
## æ¦‚è¦

[GitBucket](https://gitbucket.github.io/)ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³[GitBucket Markdown Enhanced Plugin](https://github.com/yasumichi/gitbucket-markdown-enhanced)ã‚’é–‹ç™ºã—ã¦ã„ã¾ã™ã€‚

GitBucket Markdown Enhanced Plugin ã§ã¯ã€[KaTeX](https://katex.org/) ã«ã‚ˆã‚‹æ•°å¼ã®æç”»ãŒå¯èƒ½ã§ã™ãŒã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³ 0.3.4 ã¾ã§ã¯ã€ç·¨é›†æ™‚ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»é¢ã§ KaTeX ã«ã‚ˆã‚‹æ•°å¼ã®æç”»ãŒåƒã„ã¦ã„ã¾ã›ã‚“ã§ã—ãŸã€‚

ä»Šå›ã¯ã€ã“ã®å•é¡Œã®è§£æ¶ˆæ–¹æ³•ã«é–¢ã™ã‚‹è¨˜äº‹ã§ã™ã€‚

## å‰å›ã®è¨˜äº‹

https://zenn.dev/yasumichi/articles/7d0b42a9858912

æ™‚ç³»åˆ—ã¯é€†è»¢ã—ã¦ã„ã¾ã™ãŒâ€¦

## åŸå› 

KaTeX ã«ã‚ˆã‚‹æ•°å¼ã®æç”»ã¯ã€ä»¥ä¸‹ã®ã‚½ãƒ¼ã‚¹ã§è¡Œã£ã¦ã„ã¾ã—ãŸã€‚

[src\main\resources\gme\assets\gme.js](https://github.com/yasumichi/gitbucket-markdown-enhanced/blob/0.3.4/src/main/resources/gme/assets/gme.js)

```js
(function () {
    console.log("gme.js loaded.")

    document.addEventListener("DOMContentLoaded", function () {
        console.log("DOMContentLoaded fire")
        var mathElems = document.getElementsByClassName("katex");
        var elems = [];
        for (const i in mathElems) {
            if (mathElems.hasOwnProperty(i)) elems.push(mathElems[i]);
        }

        elems.forEach(elem => {
            katex.render(elem.textContent, elem, { throwOnError: false, displayMode: elem.nodeName !== 'SPAN', });
        });
    });
})();
```

DOMContentLoaded ã‚¤ãƒ™ãƒ³ãƒˆã‚’ãƒˆãƒªã‚¬ãƒ¼ã« KaTeX ã«ã‚ˆã‚‹æ•°å¼ã®æç”»ã‚’è¡Œã£ã¦ã„ã¾ã—ãŸãŒã€ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤ºã¯ã€ãã®ã‚¤ãƒ™ãƒ³ãƒˆã‚ˆã‚Šã‚‚å¾Œã«è¡Œã‚ã‚Œã‚‹ãŸã‚ã€å¯¾å¿œã§ãã¦ã„ã¾ã›ã‚“ã§ã—ãŸã€‚

## å¯¾å‡¦æ–¹æ³•ã®æ¤œè¨

- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã¸ã®åˆ‡æ›¿æ™‚ã€ã‚µãƒ¼ãƒãƒ¼ã« markdown ãŒ POST ã•ã‚Œã€ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°çµæœãŒè¿”ã•ã‚Œã‚‹ã€‚ã“ã‚Œã‚’æ•æ‰ã§ããªã„ã‹? â†’ ç„¡ç†ãã†ã§ã—ãŸ
- ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°çµæœãŒè¿”ã•ã‚Œã‚‹ã¨ `#preview` ã®ãƒãƒ¼ãƒ‰ã«çµæœãŒè¿½åŠ ã•ã‚Œã‚‹ã€‚ã“ã‚Œã‚’æ•æ‰ã§ããªã„ã‹ã€‚ â†’ æ–¹æ³•ãŒã‚ã‚Šãã†ã ã£ãŸã®ã§ã“ã¡ã‚‰ã‚’æ¡ç”¨

## å¯¾å‡¦å¾Œã®ã‚½ãƒ¼ã‚¹

[src\main\resources\gme\assets\gme.js](https://github.com/yasumichi/gitbucket-markdown-enhanced/blob/0.4.0/src/main/resources/gme/assets/gme.jshttps://github.com/yasumichi/gitbucket-markdown-enhanced/blob/75155e1c21db6bfebd5546200329910c5710a8ff/src/main/resources/gme/assets/gme.js)

```js
(function () {
    console.log("gme.js loaded.");

    var renderKatex = function() {
        var mathElems = document.getElementsByClassName("katex");
        var elems = [];
        for (const i in mathElems) {
            if (mathElems.hasOwnProperty(i)) elems.push(mathElems[i]);
        }

        elems.forEach(elem => {
            katex.render(elem.textContent, elem, { throwOnError: false, displayMode: elem.nodeName !== 'SPAN', });
        });
    };


    document.addEventListener("DOMContentLoaded", function(){
        var preview = document.querySelector("#preview");
        if (preview) {
            const config = { attributes: false, childList: true, subtree: false };

            const observer = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                    if (mutation.addedNodes.length == 1) {
                        observer.disconnect();
                        renderKatex();
                        observer.observe(preview, config);
                    }
                });
            });

            observer.observe(preview, config);
        }
        renderKatex();
    });
})();
```

`#preview` ã®ã‚¿ã‚°ãŒè¦‹ã¤ã‹ã£ãŸã‚‰ã€ãã®ã‚¿ã‚°ã«å­ãŒè¿½åŠ ãƒ»å‰Šé™¤ã•ã‚Œã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’ç›£è¦–ã—ã€ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®çµæœãŒè¿”ã£ã¦ããŸéš›ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã®æ¡ä»¶ã«åˆè‡´ã™ã‚‹ã¨ãã«ç›£è¦–ã‚’ä¸­æ–­ã—ã€KaTex ã«ã‚ˆã‚‹æ•°å¼ã®æç”»ã‚’è¡Œã†ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚

å‚è€ƒæ–‡çŒ®ã«ã‚‚æ›¸ã„ã¦ã‚ã‚Šã¾ã™ãŒã€ç›£è¦–ã‚’ä¸­æ–­ã›ãšã« KaTeX ã«ã‚ˆã‚‹æç”»ã‚’è¡Œã£ã¦ã—ã¾ã†ã¨ãã‚Œã«ã‚ˆã‚‹ DOM ã®å¤‰åŒ–ãŒèµ·ã“ã‚‹ã®ã§ç„¡é™ãƒ«ãƒ¼ãƒ—ã«é™¥ã£ã¦ã—ã¾ã„ã¾ã™ã€‚(çµŒé¨“è€…ã¯èªã‚‹â€¦)

## ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ

ä¸‹å›³ã®ã‚ˆã†ã«ç„¡äº‹ã€ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ™‚ã«ã‚‚æ•°å¼ãŒæç”»ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

![](https://storage.googleapis.com/zenn-user-upload/14a0aa2f796f-20251204.png)

## å‚è€ƒãƒªãƒ³ã‚¯

- [DOMï¼ˆè¦ç´ ï¼‰ã®å¤‰æ›´ã‚„æ›´æ–°ã‚’æ¤œçŸ¥ã™ã‚‹ãƒ™ã‚¹ãƒˆãªæ–¹æ³•ã€œMutationObserver APIã®ä½¿ã„æ–¹ã€JavaScriptã‚¬ã‚¤ãƒ‰ã€‘ | QooTechWEB](https://engineering.webstudio168.jp/2024/07/mutationobserver/)
- [å‹•çš„ã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãŸã‚ã®å¤‰æ›´ç›£è¦–æ‰‹æ³•ï¼šâ€MutationObserverã¨Event Listenerã®ä½¿ã„åˆ†ã‘â€ | æ ªå¼ä¼šç¤¾ã‚­ãƒ¥ã‚¯ãƒã‚¹](https://www.wantedly.com/companies/company_2966211/post_articles/906262)
- [MutationObserver - Web API | MDN](https://developer.mozilla.org/ja/docs/Web/API/MutationObserver)